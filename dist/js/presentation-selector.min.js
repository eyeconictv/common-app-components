"use strict";angular.module("risevision.common.components.presentation-selector.services",["risevision.common.gapi","risevision.core.util"]),angular.module("risevision.common.components.presentation-selector",["risevision.common.components.presentation-selector.services","risevision.common.components.scrolling-list","risevision.common.loading","ui.bootstrap"]),angular.module("risevision.common.components.presentation-selector.services").factory("presentationFactory",["$q","presentation",function(e,t){var n={},o=[];n.loadingPresentation=!1,n.apiError="",n.getPresentationCached=function(e){var t=_.find(o,{id:e});return t||(t={id:e},o.push(t),n.getPresentation(e)),t};var r=function(e){var t=n.getPresentationCached(e.id);t.name=e.name,t.revisionStatus=e.revisionStatus};return n.getPresentation=function(o){var s=e.defer();return n.loadingPresentation=!0,t.get(o).then(function(e){r(e.item),s.resolve(e.item)}).then(null,function(e){n.apiError=e.message?e.message:e.toString(),s.reject()}).finally(function(){n.loadingPresentation=!1}),s.promise},n}]),angular.module("risevision.common.components.presentation-selector.services").constant("PRESENTAION_WRITABLE_FIELDS",["name","layout","distribution","isTemplate","embeddedIds"]).constant("PRESENTAION_SEARCH_FIELDS",["name","id","revisionStatusName"]).service("presentation",["$q","$log","coreAPILoader","userState","pick","PRESENTAION_WRITABLE_FIELDS","PRESENTAION_SEARCH_FIELDS",function(e,t,n,o,r,s,i){var a=function(e,t){var n="";for(var o in e)n+="OR "+e[o]+':~"'+t+'" ';return n=n.substring(3),n.trim()},l={list:function(r,s){var l=e.defer(),c=r.query?a(i,r.query):"",d={companyId:o.getSelectedCompanyId(),search:c,cursor:s,count:r.count,sort:r.sortBy+(r.reverse?" desc":" asc")};return t.debug("list presentations called with",d),n().then(function(e){return e.presentation.list(d)}).then(function(e){t.debug("list presentations resp",e),l.resolve(e.result)}).then(null,function(e){t.error("Failed to get list of presentations.",e),l.reject(e)}),l.promise},get:function(r){var s=e.defer(),i={id:r,companyId:o.getSelectedCompanyId()};return t.debug("get presentation called with",r),n().then(function(e){return e.presentation.get(i)}).then(function(e){t.debug("get presentation resp",e),s.resolve(e.result)}).then(null,function(e){t.error("Failed to get presentation.",e),s.reject(e)}),s.promise},add:function(i){var a=e.defer(),l=r.apply(this,[i].concat(s));o.isRiseAdmin()&&(l.isStoreProduct=i.isTemplate&&i.isStoreProduct);var c={companyId:o.getSelectedCompanyId(),data:l};return n().then(function(e){return e.presentation.add(c)}).then(function(e){t.debug("added presentation",e),a.resolve(e.result)}).then(null,function(e){t.error("Failed to add presentation.",e),a.reject(e)}),a.promise},update:function(i,a){var l=e.defer(),c=r.apply(this,[a].concat(s));o.isRiseAdmin()&&(c.isStoreProduct=a.isTemplate&&a.isStoreProduct);var d={id:i,data:c};return t.debug("update presentation called with",i),n().then(function(e){return e.presentation.patch(d)}).then(function(e){t.debug("update presentation resp",e),l.resolve(e.result)}).then(null,function(e){t.error("Failed to update presentation.",e),l.reject(e)}),l.promise},"delete":function(o){var r=e.defer(),s={id:o};return t.debug("delete presentation called with",o),n().then(function(e){return e.presentation.delete(s)}).then(function(e){t.debug("delete presentation resp",e),r.resolve(e)}).then(null,function(e){t.error("Failed to delete presentation.",e),r.reject(e)}),r.promise},publish:function(o){var r=e.defer(),s={id:o};return t.debug("publish presentation called with",o),n().then(function(e){return e.presentation.publish(s)}).then(function(e){t.debug("publish presentation resp",e),r.resolve(e)}).then(null,function(e){t.error("Failed to publish presentation.",e),r.reject(e)}),r.promise},restore:function(o){var r=e.defer(),s={id:o};return t.debug("restore presentation called with",o),n().then(function(e){return e.presentation.restore(s)}).then(function(e){t.debug("restore presentation resp",e),r.resolve(e.result)}).then(null,function(e){t.error("Failed to restore presentation.",e),r.reject(e)}),r.promise}};return l}]),angular.module("risevision.common.components.presentation-selector").directive("presentationName",["presentationFactory",function(e){return{restrict:"A",scope:{id:"=presentationName"},link:function(t,n){t.$watch("id",function(n){n&&(t.presentation=e.getPresentationCached(t.id))}),t.$watch("presentation.name",function(e){e&&n.html(e)})}}}]),angular.module("risevision.common.components.presentation-selector").controller("PresentationListModalController",["$scope","$rootScope","presentation","$loading","BaseList","$filter",function(e,t,n,o,r,s){var i=40;e.presentations=new r(i),e.search={sortBy:"name",count:i,reverse:!1},e.filterConfig={placeholder:s("translate")("schedules-app.presentation-modal.search.placeholder"),id:"presentationSearchInput"},e.$watch("loadingPresentations",function(e){e?o.start("presentation-list-loader"):o.stop("presentation-list-loader")}),e.load=function(){(!e.presentations.list.length||!e.presentations.endOfList&&e.presentations.cursor)&&(e.loadingPresentations=!0,n.list(e.search,e.presentations.cursor).then(function(t){e.presentations.add(t.items?t.items:[],t.cursor)}).then(null,function(){e.error="Failed to load presentations. Please try again later."}).finally(function(){e.loadingPresentations=!1}))},e.load(),e.sortBy=function(t){e.presentations.clear(),t!==e.search.sortBy?e.search.sortBy=t:e.search.reverse=!e.search.reverse,e.load()},e.doSearch=function(){e.presentations.clear(),e.load()},e.select=function(e,n){t.$broadcast("risevision.common.components.presentation-selector.presentation-selected",e,n)}}]),angular.module("risevision.common.components.presentation-selector").controller("selectPresentationModal",["$scope","$modalInstance",function(e,t){e.$on("risevision.common.components.presentation-selector.presentation-selected",function(e,n,o){t.close([n,o])}),e.dismiss=function(){t.dismiss()}}]),angular.module("risevision.common.components.presentation-selector").filter("presentationStatus",["translateFilter",function(e){return function(t){return"Published"===t?e("schedules-app.presentation-modal.presentation-list.status.published"):"Revised"===t?e("schedules-app.presentation-modal.presentation-list.status.revised"):"N/A"}}]),function(e){try{e=angular.module("risevision.common.components.presentation-selector")}catch(t){e=angular.module("risevision.common.components.presentation-selector",[])}e.run(["$templateCache",function(e){e.put("presentation-selector/presentation-list-modal.html",'<div ng-controller="PresentationListModalController"><search-filter filter-config="filterConfig" search="search" do-search="doSearch"></search-filter><div class="panel half-top"><div class="scrollable-list" scrolling-list="load()" rv-spinner="" rv-spinner-key="presentation-list-loader" rv-spinner-start-active="1"><table id="presentationListTable" class="table-2 table-hover"><thead><tr><th id="tableHeaderName" ng-click="sortBy(\'name\')" class="clickable">{{\'schedules-app.presentation-modal.presentation-list.heading.name\' | translate}}<i ng-if="search.sortBy == \'name\'" class="fa" ng-class="{false: \'fa-long-arrow-up\', true: \'fa-long-arrow-down\'}[search.reverse]"></i></th><th id="tableHeaderStatus" class="text-right">{{\'schedules-app.presentation-modal.presentation-list.heading.status\' | translate}}</th></tr></thead><tbody><tr class="clickable-row" data-ng-click="toggleObject.item = $index; select(presentation.id, presentation.name);" data-ng-class="{\'active\' : toggleObject.item == $index}" ng-repeat="presentation in presentations.list"><td id="presentationName">{{presentation.name}}</td><td class="text-right"><span ng-class="{\'text-danger\': presentation.revisionStatus==1}">{{presentation.revisionStatusName | presentationStatus}}</span></td></tr></tbody></table></div></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.presentation-selector")}catch(t){e=angular.module("risevision.common.components.presentation-selector",[])}e.run(["$templateCache",function(e){e.put("presentation-selector/presentation-modal.html",'<div id="addPresentationModal"><div class="modal-header"><button type="button" class="close" ng-click="dismiss()" aria-hidden="true"><i class="fa fa-times"></i></button><h3 class="modal-title" translate="">schedules-app.presentation-modal.title</h3></div><div class="modal-body" stop-event="touchend" ng-include="" src="\'presentation-selector/presentation-list-modal.html\'"></div></div>')}])}();